\hypertarget{Usb-Hardware_8h}{}\doxysection{usb-\/bridge/src/\+Usb-\/\+Hardware.h File Reference}
\label{Usb-Hardware_8h}\index{usb-\/bridge/src/Usb-\/Hardware.h@{usb-\/bridge/src/Usb-\/Hardware.h}}


{\ttfamily usb-\/bridge} communicates over USB via FTDI USB Bridge IC {\ttfamily FT221X}  


{\ttfamily \#include $<$stdint.\+h$>$}\newline
{\ttfamily \#include $<$avr/io.\+h$>$}\newline
{\ttfamily \#include \char`\"{}Usb.\+h\char`\"{}}\newline
\doxysubsection*{Variables}
\begin{DoxyCompactItemize}
\item 
\mbox{\Hypertarget{Usb-Hardware_8h_ab992442dd2c0c5374a39ed14eab85d53}\label{Usb-Hardware_8h_ab992442dd2c0c5374a39ed14eab85d53}} 
usb\+\_\+reg {\bfseries Ft\+Ctrl\+\_\+ddr} = \&DDRC
\item 
\mbox{\Hypertarget{Usb-Hardware_8h_ab7091923ead96672739f33e82a096094}\label{Usb-Hardware_8h_ab7091923ead96672739f33e82a096094}} 
usb\+\_\+reg {\bfseries Ft\+Ctrl\+\_\+port} = \&PORTC
\item 
\mbox{\Hypertarget{Usb-Hardware_8h_a1b7a5000fb5015d23662970079d1d0e1}\label{Usb-Hardware_8h_a1b7a5000fb5015d23662970079d1d0e1}} 
usb\+\_\+reg {\bfseries Ft\+Ctrl\+\_\+pin} = \&PINC
\item 
\mbox{\Hypertarget{Usb-Hardware_8h_ac97196ef5dca036bc1fba36d67325424}\label{Usb-Hardware_8h_ac97196ef5dca036bc1fba36d67325424}} 
usb\+\_\+reg {\bfseries Ft\+Data\+\_\+pin} = \&PIND
\item 
\mbox{\Hypertarget{Usb-Hardware_8h_acaf8f8bac074289392678352e8e3ddf6}\label{Usb-Hardware_8h_acaf8f8bac074289392678352e8e3ddf6}} 
usb\+\_\+reg {\bfseries Ft\+Data\+\_\+ddr} = \&DDRD
\item 
\mbox{\Hypertarget{Usb-Hardware_8h_aaf03b40c961fd03755952e6aff10c3f4}\label{Usb-Hardware_8h_aaf03b40c961fd03755952e6aff10c3f4}} 
usb\+\_\+reg {\bfseries Ft\+Data\+\_\+port} = \&PORTD
\item 
\mbox{\Hypertarget{Usb-Hardware_8h_a85cc27df45f177467d7928fcc65e3752}\label{Usb-Hardware_8h_a85cc27df45f177467d7928fcc65e3752}} 
usb\+\_\+pin {\bfseries Ft\+Miso} = PC2
\item 
\mbox{\Hypertarget{Usb-Hardware_8h_ad76db4dc979cb09a5d2753ed60c81140}\label{Usb-Hardware_8h_ad76db4dc979cb09a5d2753ed60c81140}} 
usb\+\_\+pin {\bfseries Ft\+Chip\+Select} = PC0
\item 
\mbox{\Hypertarget{Usb-Hardware_8h_a7ea8b38f4b1f7f81f7fe4bff8e919dea}\label{Usb-Hardware_8h_a7ea8b38f4b1f7f81f7fe4bff8e919dea}} 
usb\+\_\+pin {\bfseries Ft\+Clock} = PC1
\item 
\mbox{\Hypertarget{Usb-Hardware_8h_a434843a24a30c3f38faef5f0b432aa94}\label{Usb-Hardware_8h_a434843a24a30c3f38faef5f0b432aa94}} 
usb\+\_\+pin {\bfseries Ft\+Miosio0} = PD0
\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
{\ttfamily usb-\/bridge} communicates over USB via FTDI USB Bridge IC {\ttfamily FT221X} 

About the {\ttfamily FT221X}\+:


\begin{DoxyItemize}
\item Provides an embedded interface to a {\bfseries{USB host}}
\begin{DoxyItemize}
\item embedded system {\bfseries{microcontroller}} is the {\bfseries{FT1248 master}}
\item {\bfseries{microcontroller}} sees {\ttfamily FT221X} as {\bfseries{FT1248 slave}}
\item {\bfseries{USB host}} sees {\ttfamily FT221X} as a {\bfseries{USB device}}
\item {\ttfamily USB} protocol is entirely handled by the {\ttfamily FT221X}
\end{DoxyItemize}
\item Data\+:
\begin{DoxyItemize}
\item USB 2.\+0 Full Speed capable
\item Data transfer rate up to 1MByte/s (TODO\+: measure)
\item 512-\/byte receive buffer
\item 512-\/byte transmit buffer
\end{DoxyItemize}
\item USB Driver options for Windows, Mac OS X, and Linux\+:
\begin{DoxyItemize}
\item Virtual Com Port (VCP)
\begin{DoxyItemize}
\item this is what {\ttfamily pyserial} uses
\item Chromation uses {\ttfamily pyserial} for the Python API
\end{DoxyItemize}
\item D2\+XX
\begin{DoxyItemize}
\item FTDI-\/specific extended functionality
\item write your own Python package to wrap D2\+XX API calls
\begin{DoxyItemize}
\item examples available on the internet
\end{DoxyItemize}
\end{DoxyItemize}
\item Both types free to download from FTDI\+:
\begin{DoxyItemize}
\item \href{https://www.ftdichip.com/Drivers/VCP.htm}{\texttt{ https\+://www.\+ftdichip.\+com/\+Drivers/\+VCP.\+htm}}
\item scroll down to your operating system
\end{DoxyItemize}
\end{DoxyItemize}
\end{DoxyItemize}

{\ttfamily FT221X} usage in Chromation {\ttfamily usb-\/bridge}\+:
\begin{DoxyItemize}
\item {\ttfamily USB} to {\ttfamily FT1248}
\begin{DoxyItemize}
\item {\ttfamily usb-\/bridge} uses {\ttfamily FT1248} mode with 8-\/bit-\/wide data bus
\item {\ttfamily USB} protocol is entirely handled by the {\ttfamily FT221X}
\begin{DoxyItemize}
\item {\ttfamily usb-\/bridge} firmware implements an {\ttfamily FT1248} master
\item {\ttfamily usb-\/bridge} firmware is ignorant of {\ttfamily USB} specifics
\end{DoxyItemize}
\end{DoxyItemize}
\item Program internal 2kB memory via FTDI GUI {\ttfamily FT\+\_\+\+Prog}\+:
\begin{DoxyItemize}
\item Chromation serial number\+: {\ttfamily CHROMATION123456}
\begin{DoxyItemize}
\item each dev-\/kit has a unique six-\/digit serial number
\end{DoxyItemize}
\item {\itshape Ft1248 Settings}
\begin{DoxyItemize}
\item {\itshape Clock Polarity High}\+: {\ttfamily uncheck}
\item {\itshape Bit Order LSB}\+: {\ttfamily check}
\item {\itshape Flow Ctrl not selected}\+: {\ttfamily check}
\begin{DoxyItemize}
\item implements flow control when {\ttfamily FT221X} is not selected
\end{DoxyItemize}
\end{DoxyItemize}
\item {\itshape CBUS Signals}
\begin{DoxyItemize}
\item {\itshape C3}\+: {\ttfamily GPIO}
\end{DoxyItemize}
\end{DoxyItemize}
\item Flow control\+:
\begin{DoxyItemize}
\item when {\ttfamily FT221X} pin {\ttfamily CS\#} ({\bfseries{Not}} Chip Select) is HIGH\+:
\item reflect status of receive buffer on {\ttfamily FT221X} pin {\ttfamily MISO}
\begin{DoxyItemize}
\item receive buffer {\bfseries{has data}}\+: {\ttfamily MISO} is {\bfseries{LOW}}
\item receive buffer is empty\+: {\ttfamily MISO} is {\bfseries{HIGH}}
\item {\itshape usage\+:} wait for {\ttfamily MISO} {\bfseries{LOW}} before a read
\end{DoxyItemize}
\item reflect status of transmit buffer on {\ttfamily FT221X} pin {\ttfamily MIOSIO\mbox{[}0\mbox{]}}
\begin{DoxyItemize}
\item transmit buffer {\bfseries{is full}}\+: {\ttfamily MIOSIO\mbox{[}0\mbox{]}} is {\bfseries{LOW}}
\item transmit buffer has room\+: {\ttfamily MIOSIO\mbox{[}0\mbox{]}} is {\bfseries{HIGH}}
\item {\itshape usage\+:} wait for {\ttfamily MIOSIO\mbox{[}0\mbox{]}} {\bfseries{HIGH}} before a write
\end{DoxyItemize}
\end{DoxyItemize}
\item Dev-\/kit hard reset\+:
\begin{DoxyItemize}
\item {\ttfamily FT221X} pin {\ttfamily CBUS3} connects to the microcontroller RESET pin
\item USB host drives CBUS3 LOW to {\bfseries{hard reset}} the dev-\/kit 
\end{DoxyItemize}
\end{DoxyItemize}