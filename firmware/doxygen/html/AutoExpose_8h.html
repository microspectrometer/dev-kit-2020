<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>firmware: vis-spi-out/src/AutoExpose.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="custom.css" rel="stylesheet" type="text/css"/>
<link href="custom_dark_theme.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">firmware
   &#160;<span id="projectnumber">v0</span>
   </div>
   <div id="projectbrief">Protocol compatible with Python package microspeclib</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_45aebda92af6c5c89a9dd068cd7825b2.html">vis-spi-out</a></li><li class="navelem"><a class="el" href="dir_0bf3d13dcb58c8d242d72b1b2dbe7783.html">src</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">AutoExpose.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;stdint.h&gt;</code><br />
<code>#include &lt;stdbool.h&gt;</code><br />
</div>
<p><a href="AutoExpose_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a38545a4f257a94dab01cf4d4ef994a41"><td class="memItemLeft" align="right" valign="top"><a id="a38545a4f257a94dab01cf4d4ef994a41"></a>
uint16_t&#160;</td><td class="memItemRight" valign="bottom"><b>_MinPeak</b> (uint16_t <a class="el" href="AutoExpose_8h.html#af27d9627f4a2f2839ae2c3500301b87e">target</a>, uint16_t <a class="el" href="AutoExpose_8h.html#a68197a7b63858a45475d838e4a350348">target_tolerance</a>)</td></tr>
<tr class="separator:a38545a4f257a94dab01cf4d4ef994a41"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acb2a80cca41c1f12e39c3c35e2ecb8f4"><td class="memItemLeft" align="right" valign="top"><a id="acb2a80cca41c1f12e39c3c35e2ecb8f4"></a>
uint16_t&#160;</td><td class="memItemRight" valign="bottom"><b>_MaxPeak</b> (uint16_t <a class="el" href="AutoExpose_8h.html#af27d9627f4a2f2839ae2c3500301b87e">target</a>, uint16_t <a class="el" href="AutoExpose_8h.html#a68197a7b63858a45475d838e4a350348">target_tolerance</a>)</td></tr>
<tr class="separator:acb2a80cca41c1f12e39c3c35e2ecb8f4"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a17a3968dbb1f295867f6cc196bd31371"><td class="memItemLeft" align="right" valign="top"><a id="a17a3968dbb1f295867f6cc196bd31371"></a>
uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="AutoExpose_8h.html#a17a3968dbb1f295867f6cc196bd31371">max_tries</a></td></tr>
<tr class="memdesc:a17a3968dbb1f295867f6cc196bd31371"><td class="mdescLeft">&#160;</td><td class="mdescRight">maximum number of tries before <a class="el" href="VisCmd_8h.html#ad331578ce39d75860495a587a2a1e45e">AutoExpose()</a> gives up <br /></td></tr>
<tr class="separator:a17a3968dbb1f295867f6cc196bd31371"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1120c8c52bf6454a9572c17ab7ae8f1f"><td class="memItemLeft" align="right" valign="top"><a id="a1120c8c52bf6454a9572c17ab7ae8f1f"></a>
uint16_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="AutoExpose_8h.html#a1120c8c52bf6454a9572c17ab7ae8f1f">start_pixel</a></td></tr>
<tr class="memdesc:a1120c8c52bf6454a9572c17ab7ae8f1f"><td class="mdescLeft">&#160;</td><td class="mdescRight"><a class="el" href="VisCmd_8h.html#ad331578ce39d75860495a587a2a1e45e">AutoExpose()</a> ignores pixels below <code>start_pixel</code>. <br /></td></tr>
<tr class="separator:a1120c8c52bf6454a9572c17ab7ae8f1f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5550cfa3b685655e8877b07f7c35b8fd"><td class="memItemLeft" align="right" valign="top"><a id="a5550cfa3b685655e8877b07f7c35b8fd"></a>
uint16_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="AutoExpose_8h.html#a5550cfa3b685655e8877b07f7c35b8fd">stop_pixel</a></td></tr>
<tr class="memdesc:a5550cfa3b685655e8877b07f7c35b8fd"><td class="mdescLeft">&#160;</td><td class="mdescRight"><a class="el" href="VisCmd_8h.html#ad331578ce39d75860495a587a2a1e45e">AutoExpose()</a> ignores pixels above <code>stop_pixel</code>. <br /></td></tr>
<tr class="separator:a5550cfa3b685655e8877b07f7c35b8fd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af27d9627f4a2f2839ae2c3500301b87e"><td class="memItemLeft" align="right" valign="top"><a id="af27d9627f4a2f2839ae2c3500301b87e"></a>
uint16_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="AutoExpose_8h.html#af27d9627f4a2f2839ae2c3500301b87e">target</a></td></tr>
<tr class="memdesc:af27d9627f4a2f2839ae2c3500301b87e"><td class="mdescLeft">&#160;</td><td class="mdescRight">target peak counts for <a class="el" href="VisCmd_8h.html#ad331578ce39d75860495a587a2a1e45e">AutoExpose()</a>. <br /></td></tr>
<tr class="separator:af27d9627f4a2f2839ae2c3500301b87e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a68197a7b63858a45475d838e4a350348"><td class="memItemLeft" align="right" valign="top"><a id="a68197a7b63858a45475d838e4a350348"></a>
uint16_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="AutoExpose_8h.html#a68197a7b63858a45475d838e4a350348">target_tolerance</a></td></tr>
<tr class="memdesc:a68197a7b63858a45475d838e4a350348"><td class="mdescLeft">&#160;</td><td class="mdescRight"><code>target</code> ± <code>target_tolerance</code> is the target peak counts range for <a class="el" href="VisCmd_8h.html#ad331578ce39d75860495a587a2a1e45e">AutoExpose()</a>. <br /></td></tr>
<tr class="separator:a68197a7b63858a45475d838e4a350348"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad81c4f3ebaff13164278daae98925df6"><td class="memItemLeft" align="right" valign="top"><a id="ad81c4f3ebaff13164278daae98925df6"></a>
uint16_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="AutoExpose_8h.html#ad81c4f3ebaff13164278daae98925df6">max_dark</a></td></tr>
<tr class="memdesc:ad81c4f3ebaff13164278daae98925df6"><td class="mdescLeft">&#160;</td><td class="mdescRight"><code>max_dark</code> is a conservative estimate on the largest dark offset <br /></td></tr>
<tr class="separator:ad81c4f3ebaff13164278daae98925df6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aff0baca87a62c38057db03b83be02362"><td class="memItemLeft" align="right" valign="top"><a id="aff0baca87a62c38057db03b83be02362"></a>
uint16_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="AutoExpose_8h.html#aff0baca87a62c38057db03b83be02362">min_exposure</a></td></tr>
<tr class="memdesc:aff0baca87a62c38057db03b83be02362"><td class="mdescLeft">&#160;</td><td class="mdescRight"><code>min_exposure</code> is 100 microseconds (five 20µs-cycles)<br  />
 This is a safe lower limit to avoid dead frames. <br /></td></tr>
<tr class="separator:aff0baca87a62c38057db03b83be02362"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0b2c447b1d12e1c69a0fc2f166621c38"><td class="memItemLeft" align="right" valign="top">uint16_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="AutoExpose_8h.html#a0b2c447b1d12e1c69a0fc2f166621c38">max_exposure</a></td></tr>
<tr class="memdesc:a0b2c447b1d12e1c69a0fc2f166621c38"><td class="mdescLeft">&#160;</td><td class="mdescRight"><code>max_exposure</code> is 1.31 seconds (65535 20µs-cycles)<br  />
 This is the 16-bit limit, UINT16_MAX, but it is also a practical limit on waiting time for one frame.  <a href="AutoExpose_8h.html#a0b2c447b1d12e1c69a0fc2f166621c38">More...</a><br /></td></tr>
<tr class="separator:a0b2c447b1d12e1c69a0fc2f166621c38"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><h1>Global AutoExpose config</h1>
<h2>AutoExpose maximum number of tries </h2>
<p>AutoExpose gives up if it cannot hit the target peak counts range after <code>max_tries</code> attempts. Recommended value is <b>10</b>. Use smaller numbers to speed up AutoExpose. Set the value to <b>1</b> to manually trigger each iteration and get a sense of how many tries are necessary to hit the target range. The range of allowed values is 1 to 255.</p>
<h2>AutoExpose pixel range </h2>
<p>Recommended values for <code>start_pixel</code> and <code>stop_pixel</code> depend on the spectrometer pixel-to-wavelength map file:</p><ul>
<li><code>start_pixel</code>: smallest pixel number in the map file</li>
<li><code>stop_pixel</code>: largest pixel number</li>
</ul>
<p>The default pixel range on power-up is:</p><ul>
<li><code>start_pixel = 7</code></li>
<li><code>stop_pixel = 392</code></li>
</ul>
<p>With binning on, the default pixel range is also the allowed range of values. Attempting to exceed this range, it is clamped at these boundaries. With binning off, the allowed range is <code>start_pixel = 14</code>, <code>stop_pixel = 784</code>.</p>
<h2>AutoExpose target peak counts range </h2>
<p>Recommended values for <code>target</code> and <code>target_tolerance</code> are:</p><ul>
<li><code>target</code>: <b>46420</b> counts</li>
<li><code>target_tolerance</code>: <b>3277</b> counts</li>
</ul>
<p>See details in the Doxygen for <a class="el" href="VisCmd_8h.html#ad331578ce39d75860495a587a2a1e45e">AutoExpose()</a>. Allowed values for <code>target</code> are in the range 4500 counts to 65535 counts. Attempting to set a <code>target</code> less than <b>4500</b> counts, <code>target</code> is clamped at <b>4500</b> counts. If the combination of <code>target</code> and <code>target_tolerance</code> results in target ranges extending below <b>4500</b> counts or above <b>65535</b> counts, the target tolerance is ignored and the target range is clamped at these boundaries. </p>
</div><h2 class="groupheader">Variable Documentation</h2>
<a id="a0b2c447b1d12e1c69a0fc2f166621c38"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0b2c447b1d12e1c69a0fc2f166621c38">&#9670;&nbsp;</a></span>max_exposure</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint16_t max_exposure</td>
        </tr>
      </table>
</div><div class="memdoc">

<p><code>max_exposure</code> is 1.31 seconds (65535 20µs-cycles)<br  />
 This is the 16-bit limit, UINT16_MAX, but it is also a practical limit on waiting time for one frame. </p>
<p><br  />
 For longer exposure times:</p><ul>
<li>change the datatype in firmware to uint32_t</li>
<li>revise all transmissions of exposure_ticks in <a class="el" href="VisCmd_8h.html">VisCmd.h</a> and <a class="el" href="UsbCmd_8h.html">UsbCmd.h</a> to send/receive four bytes</li>
<li>update the Python API by changing all occurrences of <code>cycles</code> in the JSON file from size:2 to size:4.</li>
</ul>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
